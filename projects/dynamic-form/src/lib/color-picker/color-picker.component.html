<span
  nz-dropdown
  [nzTrigger]="'click'"
  [nzDropdownMenu]="menu"
  class="color-wrapper"
  [formlyAttributes]="field"
  [class.disabled]="formControl.disabled"
>
  <span>
    <input class="color with-border" disabled [style.background]="formControl?.value"/>
    </span>
  <span class="color-label">{{field.templateOptions?.label}}</span>
</span>

<nz-dropdown-menu #menu>
  <div class="color-picker">
    <div class="palette">
      <div class="colors-row" *ngFor="let paletteRow of palette">
        <div *ngFor="let color of paletteRow"
             class="color"
             (click)="updateValue(color)"
             [style.background]="color"
        ></div>
      </div>
    </div>

    <div class="divider"></div>

    <div class="d-flex">
      <nz-select nzOptionHeightPx="23"
                 class="color-type-selection"
                 [nzSize]="'small'"
                 (ngModelChange)="handleColorTypeChange($event)"
                 [(ngModel)]="selectedColorType">
        <nz-option [nzValue]="colorType.HEX" [nzLabel]="colorType.HEX"></nz-option>
        <nz-option [nzValue]="colorType.RGB" [nzLabel]="colorType.RGB"></nz-option>
      </nz-select>

      <input #colorInput nz-input type="text" class="color-input"
             [nzSize]="'small'"
             [value]="inputValue"
             (blur)="handleInputValueChange(colorInput.value)">

      <div class="opacity-block">
        <i class="icon-opacity"></i>
        {{opacity}}%
      </div>
    </div>

    <nz-slider class="color-opacity-slider"
               [(ngModel)]="opacity"
               (nzOnAfterChange)="updateOpacity()"
               [nzMin]="0"
               [nzMax]="100"
               [nzDisabled]="selectedColorType === colorType.HEX"
    ></nz-slider>

    <div class="divider"></div>

    <div class="last-colors colors-row">
      <div *ngFor="let lastColor of lastPickedColors"
           class="color"
           (click)="updateValue(lastColor.color, false)"
      >
        <div class="color-bg" [style.background]="lastColor.colorWithoutOpacity"
             [class.half]="lastColor.withOpacity"></div>

        <i class="icon-opacity" [style.color]="lastColor.color"></i>
      </div>
    </div>
  </div>
</nz-dropdown-menu>
