<window-header (contextmenu)="grid.createComponentModal($event)" [window]="this">
  <instrument-select class="ml-1" [(instrument)]="instrument"></instrument-select>
  <account-select [labelTransformer]="transformAccountLabel.bind(this)" class="ml-1" (accountChange)="handleAccountChange($event)"></account-select>
</window-header>
<div (contextmenu)="grid.createComponentModal($event)" class="window-header-button">
  <button [title]="'Center'" class="wm-header-btn icon-align-center" (click)="centralize()">
  </button>
  <button nz-dropdown nzTrigger="click" [nzDropdownMenu]="menu" [title]="'Clear'"
          class="wm-header-btn icon-dom-clear-all"></button>

  <button [title]="'Settings'" class="wm-header-btn icon-setting-gear" (click)="openSettings()">
  </button>
  <button
    [title]="'Bracket'"
    [class.bracket-active]="bracketActive"
    (click)="bracketActive = !bracketActive"
    class="wm-header-btn icon-dom-bracket"></button>
  <button
    [title]="'Strategy'"
    class="wm-header-btn icon-dom-strategy"></button>
  <daily-info [instrument]="instrument"
              [showInstrumentChange]="domFormSettings?.formSettings.showInstrumentChange"
              [showOHLVInfo]="domFormSettings?.formSettings.showOHLVInfo"
              [class.d-none]="isFormOpen && !isFormOnTop"
              class="header-daily-info" [dailyInfo]="dailyInfo"></daily-info>
  <span class="window-icon-container">
    <span class="form-switcher" [class.d-none]="!isFormOpen || !isFormOnTop">
      <span [class.switch-item-active]="!isExtended" title="Slim" (click)="isExtended = false" class="slim switch-item">
        <i [class.text-active]="!isExtended" class="icon-dom-slim"></i>
      </span>
      <span [class.switch-item-active]="isExtended" title="Normal" (click)="isExtended = true"
            class="extended switch-item">
                <i [class.text-active]="isExtended" class="icon-dom-extended"></i>

      </span>
    </span>
    <i *ngFor="let item of directions" (click)="handleChangeFormPosition(item)" [title]="directionsHints[item]"
       [class.d-none]="!isFormOpen" [class.active]="currentDirection === item"
       class="icon-{{item}} direction window-icon"></i>
    <i (click)="isFormOpen = !isFormOpen" [class.active]="isFormOpen"
       [title]="isFormOpen? 'Hide': 'Show' + ' order area'" class="icon-widget-orders window-icon large"></i>
    <i (click)="isTradingLocked = !isTradingLocked"
       [class.icon-lock]="isTradingLocked"
       [class.icon-unlock]="!isTradingLocked"
       [title]="isTradingLocked? 'Lock' : 'Unlock'"
       class="window-icon large"></i>

  </span>
</div>
<div class="d-flex dom-layout {{currentDirection}}">
  <div class="order-wrapper">
    <side-form
      [instrument]="instrument"
      [accountId]="accountId"
      [ocoStep]="ocoStep"
      [trade]="trade" #domForm [class.d-none]="!isFormOpen"
      [showUnits]="bracketActive"
      [isFormOnTop]="isFormOnTop"
      [position]="position"
      [domSettings]="domFormSettings"
      [isExtended]="isExtended"
      [orders]="orders"
      (actions)="handleFormAction($event)"
      class="{{currentDirection}} orderArea {{isExtended ? 'extended': 'slim' }}">

      <ng-container headerContent>
        <daily-info [instrument]="instrument"
                    [showInstrumentChange]="domFormSettings.formSettings.showInstrumentChange"
                    [showOHLVInfo]="domFormSettings.formSettings.showOHLVInfo"
                    [dailyInfo]="dailyInfo"></daily-info>
        <nz-input-group [class.d-none]="!domFormSettings.formSettings.showPLInfo" class="pl-input"
                        [nzPrefix]="prefixTemplateUser">
          <input disabled [value]="getPl()" nz-input>
          <ng-template #prefixTemplateUser>PL</ng-template>
        </nz-input-group>
      </ng-container>
    </side-form>
  </div>
  <div class="grid-wrapper">
    <data-grid #grid
               [columns]="columns"
               [showSettingsInContextMenu]="true"
               (settingsClicked)="openSettings()"
               [showHeaderPanelInContextMenu]="true"
               [(contextMenuState)]="dataGridMenuState"
               (columnUpdate)="onColumnUpdate($event)"
               [showContextMenuSettings]="false"
               (currentCellChanged)="onCurrentCellChanged($event)"
               [showColumnTitleOnHover]="showColumnTitleOnHover"
               [afterDraw]="afterDraw"
               [onResize]="onResize.bind(this)"
               [onColumnResize]="onColumnResize.bind(this)"
               [handlers]="handlers">
    </data-grid>
  </div>

</div>
<nz-dropdown-menu #menu="nzDropdownMenu">
  <ul nz-menu class="clear-dropdown">
    <li nz-menu-item (click)="handleHotkey('clearAllTotals');handleHotkey('clearCurrentTrades') ">All</li>
    <li nz-menu-item (click)="handleHotkey('clearCurrentTrades')">Current</li>
    <li nz-menu-item (click)="handleHotkey('clearTotalTradesUp'); handleHotkey('clearCurrentTradesUp')">Up</li>
    <li nz-menu-item (click)="handleHotkey('clearTotalTradesDown'); handleHotkey('clearCurrentTradesDown')">Down</li>
    <!--<li nz-menu-item>Notes</li>-->
  </ul>
</nz-dropdown-menu>
